NANO_BOOTLOADER="boot/boot0"
NANO_KERNEL=SK6501
NANO_NAME=sk6501
NANO_DRIVE=da0
NANO_MEDIASIZE=`expr -e 16008609792 / 512` # 16G SanDisk Cruzer Fit
NANO_RAM_TMPVARSIZE=`expr -e 52428800 / 512`
NANO_MODULES="coretemp pf pflog pfsync"
NANO_PACKAGE_LIST="bash bind-tools coreutils dnsmasq ifstat iperf isc-dhcp43-server ncdu nmap lsof perl5 ssmtp tarsnap tmux vim-lite"

cust_comconsole_vt100() {
  sed -i "" -e /ttyu0/s/dialup/vt100/ ${NANO_WORLDDIR}/etc/ttys
}

cust_loader_conf() {
  cat << EOF >> ${NANO_WORLDDIR}/boot/loader.conf
beastie_disable="YES"
hint.acpi.0.disabled=1
coretemp_load="YES"
EOF
}

# http://freebsd.1045724.n5.nabble.com/10-0-BETA3-nanobsd-sh-does-not-use-pkg-tp5862439p5862531.html
cust_pkgng() {
  TEMP_RESOLV_CONF=${NANO_WORLDDIR}/etc/resolv.conf
  echo "nameserver 8.8.8.8" > ${TEMP_RESOLV_CONF}
  pkg -c ${NANO_WORLDDIR} install -y ${NANO_PACKAGE_LIST}
  pkg -c ${NANO_WORLDDIR} clean -ay
  rm ${TEMP_RESOLV_CONF}
}

cust_timezone() {
  cp ${NANO_WORLDDIR}/usr/share/zoneinfo/Europe/Helsinki ${NANO_WORLDDIR}/etc/localtime
}

cust_console_log() {
  sed -i "" -e "s/^#\(console\.info.*\)/\1/" ${NANO_WORLDDIR}/etc/syslog.conf
  cat << EOF >> ${NANO_WORLDDIR}/etc/rc.d/var
if [ ! -f /var/log/console.log ]; then
  touch /var/log/console.log; chmod 600 /var/log/console.log
fi
EOF
}

cust_dyfi_update() {
  fetch -o - http://www.dy.fi/files/dyfi-update-pl-1.2.0.tar.gz | tar xzf - -C ${NANO_WORLDDIR}/usr/local/bin --strip-components 1 dyfi-update-pl-1.2.0/dyfi-update.pl
}

customize_cmd cust_comconsole
customize_cmd cust_comconsole_vt100
customize_cmd cust_install_files
customize_cmd cust_loader_conf
customize_cmd cust_pkgng
customize_cmd cust_timezone
customize_cmd cust_console_log
customize_cmd cust_dyfi_update
